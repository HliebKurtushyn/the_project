{% extends 'base.html' %}
{% load cache static %}

{% block title %}<title> Товар - {{ product.name }}</title>{% endblock %}

{% block content %}
    {% cache 3600 product_detail product.id %}
    <div class="row g-4">
        <div class="col-md-6">
            {% if product.image %}
                <img src="{{ product.image.url }}" alt="{{ product.name }}" class="img-fluid rounded" style="max-height:600px; object-fit:cover; width:100%">
            {% else %}
                <img src="{% static 'products/no_image.svg' %}" alt="No image" class="img-fluid rounded" style="max-height:600px; object-fit:cover; width:100%">
            {% endif %}
        </div>
        <div class="col-md-6">
            <h1>{{ product.name }}</h1>
            <h4 class="text-muted">{{ product.brand.name }}</h4>
            <p class="lead">{{ product.description }}</p>

            <p class="mb-1">Розмір: <strong>{{ product.size }}</strong></p>

            {% if product.discount %}
                <p class="text-danger">Знижка: -{{ product.discount }}%</p>
                <p>Закінчується: {{ product.discount_end_date }}</p>
            {% else %}
                <p>Наразі знижок немає.</p>
            {% endif %}

            <p class="h4">Ціна: <span class="price-badge">${{ product.price }}</span></p>
        
            {% if product.stock <= 0 %}
                <p class="text-danger">Немає в наявності!</p>
            {% elif product.stock <= 5 %}
                <p class="text-warning">Невеликий запас: {{ product.stock }}</p>
            {% else %}
                <p>Наявний запас: {{ product.stock }}</p>
            {% endif %}

            <div class="mb-3">
                {% for category in product.category.all %}
                    <span class="badge bg-secondary me-1">{{ category.name }}</span>
                {% empty %}
                    <span class="text-muted">Категорій немає</span>
                {% endfor %}
            </div>

            <form action="{% url 'cart:add_to_cart' product.id %}" method="post" class="mb-2">
                {% csrf_token %}
                <div class="input-group mb-2" style="max-width:160px;">
                    <label class="input-group-text" for="id_quantity">Кількість</label>
                    <input type="number" name="quantity" id="id_quantity" value="1" min="1" max="{{ product.stock }}" required class="form-control">
                </div>
                <input type="hidden" name="next" value="{{ request.path }}">
                <button type="submit" class="btn btn-accent">Додати до кошика</button>
            </form>

            <a href="{% url 'cart:cart_detail' %}" class="btn btn-outline-secondary">Переглянути кошик</a>
        </div>
    </div>
    {% endcache %}

    {% if recently_viewed %}
        <h2 class="mt-4">Нещодавно переглянуті:</h2>
        <div class="list-group">
            {% for item in recently_viewed %}
                <a class="list-group-item list-group-item-action" href="{% url 'product:product_detail' item.id %}">{{ item.name }}</a>
            {% endfor %}
        </div>
    {% else %}
        <p class="mt-3">Продовжуйте переглядати товари, щоб тут з'явилися останні з них!</p>
    {% endif %}


{% endblock %}